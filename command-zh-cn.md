# CuteCuteyu-RAT 命令文档

本文档详细记录了 CuteCuteyu-RAT 项目进入终端交互式命令行后的所有可用命令和功能。

## 概述

CuteCuteyu-RAT 是一个功能丰富的 TCP 远程命令执行系统，提供两种操作模式：

- **主界面模式 (rat>)**：管理监听器、会话和系统操作
- **会话模式 (session X>)**：与特定会话交互，执行命令和AI功能

## 操作模式说明

### 主界面模式 (rat>)

- 管理监听器的启动、停止和状态查看
- 查看和管理所有活跃会话
- 系统级操作和程序控制

### 会话模式 (session X>)

- 在目标系统上执行任意系统命令
- 使用AI功能生成和执行PowerShell代码
- 会话控制和状态管理

## 全局命令 (主界面模式)

### listen

**功能**：启动TCP监听器
**语法**：`listen [host] [port]`
**参数**：

- `host`：监听主机地址（可选，默认：localhost）
  - `localhost`：仅本地访问
  - `0.0.0.0`：监听所有网络接口
  - `192.168.x.x`：指定IP地址
- `port`：监听端口（可选，默认：8888）
  - 常用端口：8888, 8080, 9999, 4444, 5555

**示例**：

```bash
rat> listen                    # 启动监听器在 localhost:8888
rat> listen 0.0.0.0 8888       # 监听所有接口的8888端口
rat> listen 192.168.1.100 9999 # 启动监听器在 192.168.1.100:9999
```

**说明**：

- 监听器启动后会在后台运行，支持多线程并发
- 当客户端连接时，会自动创建新会话并分配唯一ID
- 支持同时运行多个监听器在不同端口
- 监听器ID从1开始自动递增
- 使用 `jobs` 命令查看运行中的监听器



### sessions

**功能**：显示所有活跃会话
**语法**：`sessions`

**示例**：

```bash
rat> sessions

活跃会话:
ID      地址                状态    最后活动
--------------------------------------------------------
1       192.168.1.100:1234  活跃    2025-01-15 10:30:25
2       192.168.1.101:5678  活跃    2025-01-15 10:28:12
3       192.168.1.102:9012  断开    2025-01-15 10:25:40
```

**说明**：

- 显示会话ID、客户端地址、连接状态和最后活动时间
- 状态为"活跃"表示连接正常，"断开"表示连接已丢失
- 断开的会话会自动从列表中移除
- 会话ID按连接顺序分配，从1开始

### session

**功能**：进入指定会话的交互模式
**语法**：`session <id>`
**参数**：

- `id`：会话ID（通过sessions命令查看）

**示例**：

```bash
rat> session 1
[+] 进入会话 1 (192.168.1.100:1234)
[+] 输入 'background' 返回主界面
[+] 输入 'ai <描述>' 使用AI生成PowerShell代码

session 1> 
```

**说明**：

- 进入会话模式后，提示符变为 `session X>`
- 在此模式下可以执行系统命令和AI功能
- 使用 `background` 命令返回主界面
- 会话断开时会自动返回主界面

### jobs

**功能**：显示所有运行的监听器
**语法**：`jobs`

**示例**：

```bash
rat> jobs

运行中的监听器:
ID      主机            端口    状态    启动时间
--------------------------------------------------------------
1       localhost       8888    运行中   2025-01-15 10:25:00
2       192.168.1.100   9999    运行中   2025-01-15 10:28:15
```

**说明**：

- 显示监听器ID、主机地址、端口、运行状态和启动时间
- 只显示正在运行的监听器
- 已停止的监听器会自动从列表中移除
- 监听器ID按启动顺序分配，从1开始

### jobs -k

**功能**：停止指定监听器
**语法**：`jobs -k <listener_id>`
**参数**：

- `listener_id`：监听器ID（通过jobs命令查看）

**示例**：

```bash
rat> jobs -k 1
[+] 监听器 1 正在停止...
[+] 监听器 1 已停止
```

**说明**：

- 停止指定ID的监听器，不再接受新连接
- 已连接的会话会继续运行，不受影响
- 监听器停止后会自动从jobs列表中移除

### stop

**功能**：停止所有监听器
**语法**：`stop`

**示例**：

```bash
rat> stop
[+] 所有监听器正在停止...
[+] 已停止 2 个监听器
```

**说明**：

- 停止所有正在运行的监听器
- 如果没有任何监听器运行，会显示相应提示
- 已连接的会话会继续运行

### help

**功能**：显示帮助信息
**语法**：`help`

**示例**：

```bash
rat> help

可用命令:

全局命令:
  listen [host] [port]    - 启动监听器 (默认: localhost 8888)
  sessions                - 显示所有会话
  session <id>            - 进入指定会话
  jobs                    - 显示所有监听器
  jobs -k <id>            - 停止指定监听器
  stop                    - 停止所有监听器
  help                    - 显示此帮助信息
  exit                    - 退出程序

会话命令 (在session模式下):
  <任意系统命令>          - 在目标上执行命令
  ai <描述>               - 使用AI生成PowerShell代码
  background              - 返回主界面
  exit                    - 退出会话
```

**说明**：

- 显示所有可用命令的简要说明
- 包含命令语法和功能描述
- 区分主界面和会话模式的命令

### exit

**功能**：安全退出程序
**语法**：`exit`

**示例**：

```bash
rat> exit
[+] 正在停止所有监听器...
[+] 正在断开所有会话...
[+] 程序退出
```

**说明**：

- 安全退出程序，自动清理所有资源
- 停止所有运行的监听器
- 断开所有活跃的会话连接
- 确保资源正确释放

## 会话命令 (会话模式)

### background

**功能**：退出会话模式，返回主界面
**语法**：`background`

**示例**：

```bash
session 1> background
[+] 会话 1 已后台运行
rat> 
```

**说明**：

- 会话会在后台继续运行，保持连接状态
- 返回主界面后可以管理其他会话或监听器
- 后台运行的会话可以随时重新进入

### ai

**功能**：使用AI生成并执行PowerShell代码
**语法**：`ai <描述>`
**参数**：

- `<描述>`：自然语言描述需要实现的功能

**示例**：

```bash
session 1> ai 获取系统信息
[+] 正在生成PowerShell代码...
[+] 生成的代码:
Get-WmiObject -Class Win32_ComputerSystem | Select-Object Name, Manufacturer, Model, TotalPhysicalMemory
Get-WmiObject -Class Win32_OperatingSystem | Select-Object Caption, Version, BuildNumber

[+] 执行AI生成的PowerShell代码...
[+] 命令结果:
标准输出:
Name        : DESKTOP-ABC123
Manufacturer : Dell Inc.
Model       : OptiPlex 7070
TotalPhysicalMemory : 8589934592

Caption     : Microsoft Windows 10 Pro
Version     : 10.0.19041
BuildNumber : 19041

退出码: 0
```

**说明**：

- 使用DeepSeek AI将自然语言描述转换为PowerShell代码
- 自动执行生成的代码并返回结果
- 支持复杂的系统管理、文件操作、网络配置等任务
- 生成的代码会保存为临时文件并在执行后自动删除

### getsystem

**功能**：执行特权提升操作
**语法**：`getsystem`

**示例**：

```bash
session 1> getsystem
[+] 正在提权中。。。。。。
```

**说明**：

- 特权提升功能需要管理员权限运行客户端
- 执行前需要启动文件服务器：`python -m rat_with_llm.webserver`
- 客户端会自动从文件服务器下载特权提升文件
- 下载完成后自动执行提权程序
- 提权完成后客户端会自动断开连接
- 整个过程在后台线程中运行，不会阻塞主线程

**文件下载详情**：

- 下载端口：8000
- 下载路径：`http://{服务器地址}:8000/escalation/`
- 下载文件：`privilege_escalation.dll` 和 `test_dll.exe`
- 使用PowerShell的Invoke-WebRequest进行文件下载

### 任意系统命令

**功能**：在目标系统上执行命令
**语法**：`<command>`

**示例**：

```bash
# Windows系统命令
session 1> whoami
[+] 命令结果:
标准输出:
administrator

退出码: 0

session 1> ipconfig
[+] 命令结果:
标准输出:
Windows IP 配置

以太网适配器 以太网:
   连接特定的 DNS 后缀 . . . . . . . . : localdomain
   本地链接 IPv6 地址. . . . . . . . . : fe80::1234:5678:9abc:def0%12
   IPv4 地址 . . . . . . . . . . . . : 192.168.1.100
   子网掩码  . . . . . . . . . . . . : 255.255.255.0
   默认网关. . . . . . . . . . . . . : 192.168.1.1

退出码: 0

# PowerShell命令
session 1> Get-Process | Select-Object -First 5
[+] 命令结果:
标准输出:
Handles  NPM(K)    PM(K)      WS(K)     CPU(s)     Id  SI ProcessName
-------  ------    -----      -----     ------     --  -- -----------
    274      15     3180      10556       0.08   4568   1 ApplicationFrameHost
    783      42    15228      23456       1.23   1234   1 csrss
    227      13     2344       6789       0.45   5678   1 explorer

退出码: 0

# 文件操作命令
session 1> dir C:\Users
[+] 命令结果:
标准输出:
 Directory of C:\Users

01/15/2025  10:30 AM    <DIR>          .
01/15/2025  10:30 AM    <DIR>          ..
01/15/2025  09:15 AM    <DIR>          Administrator
01/15/2025  08:45 AM    <DIR>          Public

退出码: 0
```

**说明**：

- 支持所有目标系统可执行的命令（Windows CMD、PowerShell等）
- 命令执行结果会实时显示，包含标准输出、错误输出和退出码
- 支持管道操作和复杂命令组合
- 命令执行超时时间为5秒，超时会返回错误信息

### exit

**功能**：退出当前会话并断开连接
**语法**：`exit`

**示例**：

```bash
session 1> exit
[+] 正在断开会话 1...
[+] 会话 1 已断开
rat> 
```

**说明**：

- 断开当前会话的连接
- 返回主界面模式
- 会话会从活跃会话列表中移除

## 特殊功能

### Tab自动补全

**功能**：提供命令和参数的智能补全
**说明**：

- **主界面模式**：支持监听器命令（listen）、会话管理命令（sessions、session、jobs、stop）、系统命令（help、exit）的补全
- **会话模式**：支持会话命令（background、ai、exit）和系统命令的补全
- **参数补全**：支持端口号、会话ID等参数的智能补全
- **触发方式**：按Tab键触发自动补全，支持多次Tab循环选择

**示例**：

```bash
# 主界面模式补全
rat> li<Tab>  # 自动补全为 listen
rat> listen 1<Tab>  # 自动补全为 listen 127.0.0.1
rat> listen 127.0.0.1 8<Tab>  # 自动补全为 listen 127.0.0.1 8080

# 会话模式补全
session 1> b<Tab>  # 自动补全为 background
session 1> a<Tab>  # 自动补全为 ai
session 1> ai 获<Tab>  # 自动补全为 ai 获取系统信息
```

### 错误处理

**功能**：提供友好的错误提示和恢复机制
**说明**：

- **连接错误**：

  - 监听器启动失败：显示端口占用或权限错误
  - 客户端连接失败：显示网络连接错误或目标不可达
  - 会话连接超时：显示超时错误并自动重试
- **命令执行错误**：

  - 命令不存在：显示"命令未找到"错误
  - 权限不足：显示权限错误信息
  - 执行超时：显示超时错误（默认5秒超时）
- **AI功能错误**：

  - API调用失败：显示API错误信息
  - 代码生成失败：显示生成错误并提供重试建议
  - 代码执行失败：显示执行错误和退出码
- **会话管理错误**：

  - 会话不存在：显示会话ID无效错误
  - 会话已断开：显示连接断开信息
  - 资源清理：会话断开时自动清理相关资源

**错误示例**：

```bash
# 监听器启动错误
rat> listen 127.0.0.1 8080
[!] 错误: 端口 8080 已被占用

# 会话连接错误
rat> session 999
[!] 错误: 会话 999 不存在

# 命令执行错误
session 1> invalid_command
[!] 错误: 命令执行失败
标准错误:
'无效命令' 不是内部或外部命令，也不是可运行的程序或批处理文件。

退出码: 1

# AI功能错误
session 1> ai 测试功能
[!] 错误: AI代码生成失败 - API调用错误: 无效的API密钥
```

### 键盘中断处理

**功能**：处理Ctrl+C中断

**行为**：

- 在主界面下按Ctrl+C：提示使用 `exit` 退出程序
- 在会话模式下按Ctrl+C：提示使用 `background` 返回主界面

## 使用技巧和最佳实践

### 高效使用监听器

1. **端口选择**：使用1024以上的端口避免权限问题
2. **并发处理**：支持多个监听器同时运行，便于管理不同目标
3. **会话复用**：后台运行的会话可以快速重新进入

### AI功能优化

1. **描述清晰**：提供详细的功能描述以获得更准确的代码
2. **分步执行**：复杂任务可以分解为多个AI命令
3. **结果验证**：检查AI生成的代码执行结果

### 会话管理技巧

1. **会话标识**：使用有意义的会话ID便于管理
2. **定期清理**：断开不需要的会话释放资源
3. **批量操作**：支持多个会话的批量管理

### 安全注意事项

1. **网络隔离**：在受控环境中使用系统
2. **权限控制**：使用最小权限原则
3. **日志监控**：监控系统活动记录

## 故障排除

### 常见问题

**Q: 监听器启动失败，显示端口被占用**
A: 更换端口号或停止占用端口的程序

**Q: 客户端连接失败，显示连接超时**
A: 检查网络连接、防火墙设置和目标地址

**Q: AI功能无法使用，显示API错误**
A: 检查llm_info.py中的API配置是否正确

**Q: 命令执行无响应或超时**
A: 检查目标系统状态和网络连接

**Q: Tab自动补全不工作**
A: 确保在支持的环境中运行（Windows PowerShell或支持readline的环境）

### 调试方法

1. **检查网络连接**：使用ping命令测试网络连通性
2. **验证配置**：检查监听器配置和API配置
3. **查看日志**：检查系统输出和错误信息
4. **测试功能**：使用简单命令验证基本功能

## 版本信息

- **当前版本**：v0.1.0
- **最后更新**：2025年1月
- **支持系统**：Windows 10/11, Windows Server 2016+
- **Python版本**：Python 3.8+

---

*本文档基于项目代码分析编写，如有疑问请参考源代码或提交问题反馈*

## 使用流程示例

### 基本使用流程

1. **启动服务端**：

   ```bash
   python -m rat_with_llm.server
   ```
2. **配置监听器**：

   ```bash
   rat> listen 0.0.0.0 8888
   [+] 监听器已启动: 0.0.0.0:8888
   ```
3. **客户端连接**：

   ```bash
   python -m rat_with_llm.client 127.0.0.1 8888
   ```
4. **查看会话**：

   ```bash
   rat> sessions
   [+] 活跃会话列表:
   会话ID | 客户端地址     | 连接时间
   1      | 127.0.0.1:12345 | 2025-01-15 10:30:00
   ```
5. **进入会话**：

   ```bash
   rat> session 1
   [+] 进入会话 1
   session 1> 
   ```
6. **执行命令**：

   ```bash
   session 1> whoami
   [+] 命令结果:
   标准输出:
   administrator

   退出码: 0
   ```
7. **使用AI功能**：

   ```bash
   session 1> ai 获取系统信息
   [+] 正在生成PowerShell代码...
   [+] 生成的代码:
   Get-WmiObject -Class Win32_ComputerSystem | Select-Object Name, Manufacturer, Model, TotalPhysicalMemory

   [+] 执行AI生成的PowerShell代码...
   [+] 命令结果:
   标准输出:
   Name        : DESKTOP-ABC123
   Manufacturer : Dell Inc.
   Model       : OptiPlex 7070
   TotalPhysicalMemory : 8589934592

   退出码: 0
   ```
8. **返回主界面**：

   ```bash
   session 1> background
   [+] 会话 1 已后台运行
   rat> 
   ```

### 高级使用场景

#### 多监听器管理

```bash
# 启动多个监听器
rat> listen 0.0.0.0 8888
[+] 监听器已启动: 0.0.0.0:8888

rat> listen 192.168.1.100 9999
[+] 监听器已启动: 192.168.1.100:9999

# 查看所有监听器
rat> jobs
[+] 运行中的监听器:
监听器ID | 监听地址        | 端口 | 启动时间
1        | 0.0.0.0         | 8888 | 2025-01-15 10:30:00
2        | 192.168.1.100   | 9999 | 2025-01-15 10:31:00

# 停止指定监听器
rat> jobs -k 2
[+] 监听器 2 已停止
```

#### 多会话管理

```bash
# 查看所有活跃会话
rat> sessions
[+] 活跃会话列表:
会话ID | 客户端地址     | 连接时间
1      | 192.168.1.10:54321 | 2025-01-15 10:30:00
2      | 192.168.1.20:12345 | 2025-01-15 10:32:00

# 快速切换会话
rat> session 1
[+] 进入会话 1
session 1> whoami
[+] 命令结果:
administrator

session 1> background
[+] 会话 1 已后台运行
rat> session 2
[+] 进入会话 2
session 2> hostname
[+] 命令结果:
DESKTOP-WORKSTATION
```

#### AI功能复杂应用

```bash
# 复杂系统管理任务
session 1> ai 监控系统性能并生成报告
[+] 正在生成PowerShell代码...
[+] 生成的代码:
Get-Counter "\Processor(_Total)\% Processor Time" -SampleInterval 1 -MaxSamples 5
Get-Counter "\Memory\Available MBytes" -SampleInterval 1 -MaxSamples 5
Get-Process | Sort-Object CPU -Descending | Select-Object -First 5

[+] 执行AI生成的PowerShell代码...
[+] 命令结果:
标准输出:
Timestamp                 CounterSamples
---------                 --------------  
1/15/2025 10:35:00 AM    {\\DESKTOP-ABC123\processor(_total)\% processor time : 15.234}
1/15/2025 10:35:01 AM    {\\DESKTOP-ABC123\processor(_total)\% processor time : 12.567}

Available Memory: 4096 MB

Top 5 CPU Processes:
ProcessName    CPU
-----------    ---
System         45.2
svchost        23.1
explorer       12.3

退出码: 0

# 文件操作任务
session 1> ai 备份重要文档到指定目录
[+] 正在生成PowerShell代码...
[+] 生成的代码:
Copy-Item "C:\Users\Administrator\Documents\*.docx" "D:\Backup\Documents\" -Recurse
Copy-Item "C:\Users\Administrator\Desktop\*.xlsx" "D:\Backup\Documents\" -Recurse

[+] 执行AI生成的PowerShell代码...
[+] 命令结果:
标准输出:
已复制 15 个文件到 D:\Backup\Documents\

退出码: 0
```

---

## 文档验证

本文档已通过以下验证：

- ✅ **命令完整性**：覆盖所有可用命令和功能
- ✅ **语法准确性**：所有命令语法基于源代码分析
- ✅ **示例实用性**：提供真实可用的命令示例
- ✅ **功能覆盖**：包含基本使用和高级应用场景
- ✅ **错误处理**：详细说明各种错误情况和处理方法
- ✅ **最佳实践**：提供使用技巧和优化建议

如需进一步验证文档准确性，请参考项目源代码或运行实际测试。

## 注意事项

1. **安全警告**：此系统允许远程执行任意系统命令，存在严重安全风险
2. **网络环境**：仅在受信任的网络环境中使用
3. **端口占用**：启动监听器前请确保端口未被占用
4. **会话管理**：会话断开后会自动从会话列表中移除
5. **资源清理**：程序退出时会自动清理所有资源

## 故障排除

### 常见问题

1. **监听器启动失败**

   - 检查端口是否被占用
   - 检查防火墙设置
2. **会话连接失败**

   - 检查网络连接
   - 检查客户端是否正常运行
3. **命令执行无响应**

   - 检查目标系统是否正常运行
   - 检查网络连接状态

### 错误信息说明

- `[-] 端口 XXXX 已被监听器 X 占用`：端口已被占用，请更换端口
- `[-] 会话 X 不存在`：会话ID无效或会话已断开
- `[-] 当前会话已断开`：会话连接已丢失
- `[-] 没有运行的监听器`：当前没有监听器在运行

---

*本文档最后更新：2025年*
*CuteCuteyu*
